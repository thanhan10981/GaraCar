
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω kh√°ch h√†ng</title>
</head>
<body>
    
</body>
</html><div class="container">
    <div class="sidebar_content">
        <div class="title">
            <h2 class="text-xl">Kh√°ch H√†ng</h2>
        </div>
        <div class="sidebar">
            <h4 class="text-sm">Ng∆∞·ªùi t·∫°o</h4>
            <select [(ngModel)]="selectedCreator" (change)="filterCustomers()">
                <option value="">Ch·ªçn ng∆∞·ªùi t·∫°o</option>
                <option value="admin">Admin</option>
                <option value="user1">User 1</option>
            </select>
        </div>
        <div class="sidebar">
        <h4 class="text-sm">Ng√†y t·∫°o</h4>
        <div class="time-options">
            <!-- Radio: H√¥m nay -->
            <label class="radio-option">
            <input
                type="radio"
                name="thoigian"
                value="today"
                [(ngModel)]="selectedTime"
                (change)="onTimeChange()"
            />
            <span>{{ todayLabel }}</span>
            </label>

            <!-- Radio: L·ª±a ch·ªçn kh√°c -->
            <label class="radio-option">
            <input
                type="radio"
                name="thoigian"
                value="custom"
                [(ngModel)]="selectedTime"
                (change)="onTimeChange()"
            />
            <span>L·ª±a ch·ªçn kh√°c</span>
            </label>

            <!-- Hi·ªÉn th·ªã b·ªô ch·ªçn kho·∫£ng ng√†y n·∫øu l√† custom -->
            <div *ngIf="showDateRange" class="date-range-picker">
            <label>T·ª´:</label>
            <input type="date" [(ngModel)]="fromDate" />

            <label>ƒê·∫øn:</label>
            <input type="date" [(ngModel)]="toDate" />

            <button (click)="filterCustomers()">T√¨m</button>
            </div>
        </div>
        </div>

        <div class="sidebar">
            <h4 class="text-sm">Lo·∫°i Kh√°ch</h4>
            <div class="radio-group1">
                <label><input type="radio" value="tatca" name="loaiKhach" [(ngModel)]="selectedLoaiKhach" (change)="filterCustomers()"> T·∫•t c·∫£</label>
                <label><input type="radio" value="C√° nh√¢n" name="loaiKhach" [(ngModel)]="selectedLoaiKhach" (change)="filterCustomers()"> C√° nh√¢n</label>
                <label><input type="radio" value="C√¥ng ty" name="loaiKhach" [(ngModel)]="selectedLoaiKhach" (change)="filterCustomers()"> C√¥ng ty</label>
            </div>
        </div>
        <div class="sidebar">
            <h4 class="text-sm">Tr·∫°ng th√°i</h4>
            <div class="radio-group1">
                <label><input type="radio" value="tatca" name="trangThai" [(ngModel)]="selectedTrangThai" (change)="filterCustomers()"> T·∫•t c·∫£</label>
                <label><input type="radio" value="ƒêang ho·∫°t ƒë·ªông" name="trangThai" [(ngModel)]="selectedTrangThai" (change)="filterCustomers()"> ƒêang ho·∫°t ƒë·ªông</label>
                <label><input type="radio" value="Ng·ª´ng ho·∫°t ƒë·ªông" name="trangThai" [(ngModel)]="selectedTrangThai" (change)="filterCustomers()"> Ng·ª´ng ho·∫°t ƒë·ªông</label>
            </div>
        </div>
    </div>
    
    <main class="main-content ">
        <div class="search-actions ">
            <div class="search-wrapper ">
                <div class="search-box ">
                    <i class="fas fa-search search-icon "></i>
                    <input type="text " [(ngModel)]="searchKeyword " class="search-input " (focus)="showDropdown=true " />
                    <button class="dropdown-toggle " (click)="toggleDropdown() ">
                <i class="fas fa-chevron-down "></i>
              </button>

                    <div class="dropdown-menu " *ngIf="showDropdown ">
                        <div class="dropdown-item " *ngFor="let option of searchOptions " [class.active]="selectedOption=== option.value " (click)="selectOption(option) ">
                            {{ option.label }}
                        </div>

                        <button class="btn btn-search-inside " (click)="onSearch() ">
                  <i class="fas fa-search "></i> T√¨m ki·∫øm
                </button>
                    </div>
                </div>
            </div>

            <div class="button-group ">
                <button class="btn btn-success" title="X√≥a ƒë√£ ch·ªçn" *ngIf="anyCustomerSelected()" (click)="confirmDeleteSelected()">
                <i class="fa-solid fa-trash"></i> X√≥a ƒë√£ ch·ªçn
                </button>
                <button class="btn btn-success " title="Th√™m kh√°ch h√†ng " (click)="openModalAdd()">
                  <i class="fas fa-plus "></i> Kh√°ch h√†ng
                </button>
                <div class="dropdown-wrapper ">
                    <button class="btn btn-success dropdown-btn " title="Xu·∫•t file ">
                    <i class="fas fa-file-alt "></i> File <i class="fas fa-caret-down ml-1 "></i>
                  </button>
                    <div class="dropdown-menu ">
                        <label class="dropdown-item"(click)="showImportForm = true">
                            <i class="fas fa-file-import"></i> Import
                        </label>

                        <div class="dropdown-item " (click)="exportToExcel()">
                            <i class="fas fa-file-export "></i> Xu·∫•t file
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-backdrop" *ngIf="showFormAdd">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="text-2xl font-medium">Th√™m kh√°ch h√†ng</h3>
                        <button class="close-btn" (click)="closeModalAdd()">√ó</button>
                    </div>
                    <form #Form="ngForm"  (ngSubmit)="save(Form)"class="modal-body">
                        <div class="form-grid">
                            <!-- C·ªôt 1 -->
                            <div>
                                <div class="customer-image">
                                    <!-- ·∫®n ch·ªçn ·∫£nh -->
                                    <input type="file" #imageInput hidden (change)="onImageSelected($event,'create')">
                                    <img [src]="customer.HinhAnh||'assets/default-avatar.png'" alt="">
                                    <button type="button" (click)="imageInput.click()">Ch·ªçn ·∫£nh</button>

                                </div>
                                <label>M√£ kh√°ch h√†ng</label>
                                <input [(ngModel)]="customer.MaKhachHang" name="MaKhachHang" readonly placeholder="M√£ kh√°ch h√†ng t·ª± ƒë·ªông">

                                <label>T√™n kh√°ch h√†ng</label>
                                <input [(ngModel)]="customer.TenKhachHang" name="TenKhachHang" placeholder="Nh·∫≠p t√™n ...">

                                <label>ƒêi·ªán tho·∫°i</label>
                                <input [(ngModel)]="customer.SoDienThoai" name="SoDienThoai" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ...">

                                <label>Ng√†y sinh</label>
                                <input type="date" [(ngModel)]="customer.NgaySinh" name="NgaySinh">
                                <div class="form-row">
                                    <label class="form-label">Gi·ªõi t√≠nh</label>
                                    <div class="radio-group">
                                        <label><input type="radio" [(ngModel)]="customer.GioiTinh" name="gioitinh" value="Nam"> Nam</label>
                                        <label><input type="radio" [(ngModel)]="customer.GioiTinh" name="gioitinh" value="N·ªØ"> N·ªØ</label>
                                    </div>
                                </div>

                                <label>ƒê·ªãa ch·ªâ</label>
                                <input [(ngModel)]="customer.DiaChi" name="DiaChi" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ...">
                            </div>
                            <!-- C·ªôt 2 -->
                            <div>
                                <div class="form-row">
                                    <label class="form-label">Lo·∫°i kh√°ch</label>
                                    <div class="radio-group">
                                        <label><input type="radio" [(ngModel)]="customer.LoaiKhach" name="LoaiKhach" value="C√° nh√¢n"> C√° nh√¢n</label>
                                        <label><input type="radio" [(ngModel)]="customer.LoaiKhach" name="LoaiKhach" value="C√¥ng ty"> C√¥ng ty</label>
                                    </div>
                                </div>
                                <label>M√£ s·ªë thu·∫ø</label>
                                <input [(ngModel)]="customer.MaSoThue" name="MaSoThue" placeholder="Nh·∫≠p m√£ s·ªë thu·∫ø...">

                                <label>CMND/CCCD</label>
                                <input [(ngModel)]="customer.CmndCccd " name="CmndCccd" placeholder="Nh·∫≠p CMND/CCCD ...">

                                <label>Email</label>
                                <input [(ngModel)]="customer.Email" name="Email" placeholder="Nh·∫≠p email...">

                                <label>Facebook</label>
                                <input [(ngModel)]="customer.Facebook" name="Facebook" placeholder="Nh·∫≠p facebook...">

                                <label>Ghi ch√∫</label>
                                <textarea [(ngModel)]="customer.GhiChu" name="GhiChu" placeholder="Nh·∫≠p ghi ch√∫..."></textarea>
                            </div>
                        </div>
                        <!-- Footer -->
                        <div class="modal-footer">
                            <button type="submit" class="btn-save"><i class="fa-solid fa-floppy-disk"></i> L∆∞u</button>
                            <button type="button" (click)="closeModalAdd()" class="btn-cancel"><i class="fa-solid fa-ban"></i> B·ªè qua</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <table class="customer-table ">
            <thead>
                <tr>
                    <th><input type="checkbox" [(ngModel)]="selectAll" (change)="toggleAll()" /></th>
                    <th>M√£ kh√°ch h√†ng</th>
                    <th>T√™n kh√°ch h√†ng</th>
                    <th>Lo·∫°i kh√°ch</th>
                    <th>ƒêi·ªán tho·∫°i</th>
                    <th>Email</th>
                    <th>Ghi ch√∫</th>
                </tr>
            </thead>
          <tbody>
        <ng-container *ngFor="let c of pagedCustomers; let i = index">
            <tr (click)="selectCustomer(c, i)">
            <td><input type="checkbox" [(ngModel)]="c.selected" (click)="$event.stopPropagation()" /></td>
            <td>{{ c.MaKhachHang }}</td>
            <td>{{ c.TenKhachHang }}</td>
            <td>{{ c.LoaiKhach }}</td>
            <td>{{ c.SoDienThoai }}</td>
            <td>{{ c.Email }}</td>
            <td>{{ c.GhiChu }}</td>
            </tr>

            <!-- Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt n·∫øu l√† kh√°ch h√†ng ƒë∆∞·ª£c ch·ªçn -->
            <tr *ngIf="selectedCustomer && selectedIndex === i">
            <td colspan="8">
                <div class="customer-detail-box">
                <!-- Th√¥ng tin chi ti·∫øt -->
                <div class="header">
                    <div class="left">
                    <div class="avatar"><img [src]="getImageUrl(selectedCustomer.HinhAnh)" alt="">
                    </div>
                    </div>
                    <div class="right">
                    <div class="row">
                        <div><strong>M√£ kh√°ch h√†ng:</strong> {{ selectedCustomer.MaKhachHang }}</div>
                    </div>
                    <div class="row">
                        <div><strong>T√™n kh√°ch:</strong> {{ selectedCustomer.TenKhachHang }}</div>
                    </div>
                    <div class="row">
                        <div><strong>Ng√†y sinh:</strong> {{ selectedCustomer.NgaySinh| date: 'dd/MM/yyyy'  }}</div>
                    </div>
                    <div class="row">
                        <div><strong>Lo·∫°i kh√°ch:</strong> {{ selectedCustomer.LoaiKhach }}</div>
                    </div>
                    <div class="row">
                        <div><strong>Ng∆∞·ªùi t·∫°o:</strong> {{ selectedCustomer.NguoiTao}}</div>
                    </div>
                        <div class="row">
                        <div><strong>M√£ s·ªë thu·∫ø:</strong> {{ selectedCustomer.MaSoThue}}</div>
                    </div>
                    </div>
                    <div class="left">
                    <div class="row">
                        <div><strong>ƒêi·ªán tho·∫°i:</strong> {{ selectedCustomer.SoDienThoai }}</div>
                    </div>
                    <div class="row">
                        <div><strong>ƒê·ªãa ch·ªâ:</strong> {{ selectedCustomer.DiaChi }}</div>
                    </div>
                    <div class="row">
                        <div><strong>Email:</strong> {{ selectedCustomer.Email }}</div>
                    </div>
                        <div class="row">
                        <div><strong>Facebook:</strong> {{ selectedCustomer.Facebook }}</div>
                    </div>
                    <div class="row">
                        <div><strong>Ng√†y t·∫°o:</strong> {{ selectedCustomer.NgayTao | date: 'dd/MM/yyyy HH:mm' }}</div>
                    </div>
                        <div class="row">
                        <div><strong>Tr·∫°ng th√°i:</strong> {{ selectedCustomer.TrangThai}}</div>
                    </div>
                    </div>
                </div>

                <!-- Ghi ch√∫ -->
                <div class="note">
                    <i>Ghi ch√∫:</i> {{ selectedCustomer.GhiChu }}
                </div>

                <!-- C√°c h√†nh ƒë·ªông -->
                <div class="detail-actions">
                    <button class="btn btn-success"(click)="openModal(selectedCustomer)">
                    <i class="fa-solid fa-square-check"></i> C·∫≠p nh·∫≠t
                    </button>
                <button class="bt-action" (click)="confirmDeactivation(selectedCustomer)">
                    <i class="fa-solid fa-lock"></i> Ng·ª´ng ho·∫°t ƒë·ªông
                    </button>

                    <button class="bt-action" (click)="openDeleteConfirm(selectedCustomer.MaKhachHang)">
                    <i class="fa-solid fa-trash"></i> X√≥a
                    </button>
                </div>
                </div>
            </td>
            </tr>
        </ng-container>
        <!-- FORM x√°c nh·∫≠n xo√° -->
        <div class="confirm-backdrop" *ngIf="showDeleteConfirm">
        <div class="confirm-box">
            <h3>X√°c nh·∫≠n xo√°</h3>
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° kh√°ch h√†ng n√†y kh√¥ng?</p>
            <div class="btn-group">
            <button (click)="confirmDeleteCustomer()"><i class="fa-solid fa-trash"></i> Xo√°</button>
            <button (click)="cancelDeleteCustomer()"><i class="fa-solid fa-ban"></i> Hu·ª∑</button>
            </div>
        </div>
        </div>
        <!-- FORM x√°c nh·∫≠n ng·ª´ng ho·∫°t ƒë·ªông -->
        <div class="modal-overlay-1" *ngIf="showConfirmBox">
        <div class="modal-content-1">
            <div class="modal-header-1">
            <h3>X√°c nh·∫≠n</h3>
            <button class="close-btn" (click)="cancelDeactivation()">√ó</button>
            </div>
            <div class="modal-body-1">
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ng·ª´ng ho·∫°t ƒë·ªông kh√°ch h√†ng n√†y kh√¥ng?</p>
            <p class="note">Th√¥ng tin v√† giao d·ªãch c·ªßa kh√°ch h√†ng n√†y v·∫´n s·∫Ω ƒë∆∞·ª£c gi·ªØ.</p>
            </div>
            <div class="modal-footer-1">
            <button class="btn-red" (click)="deactivateCustomer()"><i class="fa-solid fa-square-check"></i> ƒê·ªìng √Ω</button>
            <button class="btn-gray" (click)="cancelDeactivation()"><i class="fa-solid fa-ban"></i> B·ªè qua</button>
            </div>
        </div>
    </div>
    </tbody>
        </table>
        <div class="modal-backdrop" *ngIf="showForm">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="text-base">Kh√°ch h√†ng {{SelectedCustomer?.MaKhachHang}}</h3>
                    <button class="close-btn" (click)="closeModal()">√ó</button>
                </div>

                <form #UpdateForm="ngForm" (ngSubmit)="updateCustomer(UpdateForm)" class="modal-body">
                    <div class="form-grid">
                        <!-- C·ªôt 1 -->
                        <div>
                            <div class="customer-image">
                                <img [src]=" getSelectedCustomerImage()" alt="">
                                <button type="button" (click)="imageInput.click()">Ch·ªçn ·∫£nh</button>
                                <input type="file" #imageInput hidden (change)="onImageSelected($event, 'update')">
                            </div>

                            <label>M√£ kh√°ch h√†ng</label>
                            <input type="text" [(ngModel)]="SelectedCustomer.MaKhachHang" name="MaKhachHang"readonly>

                            <label>T√™n kh√°ch h√†ng</label>
                            <input type="text" [(ngModel)]="SelectedCustomer.TenKhachHang" name="TenKhachHang">

                            <label>ƒêi·ªán tho·∫°i</label>
                            <input type="text"[(ngModel)]="SelectedCustomer.SoDienThoai" name="SoDienThoai">

                            <label>Ng√†y sinh</label>
                            <input type="text" [(ngModel)]="SelectedCustomer.NgaySinh" name="NgaySinh">
                            <div class="form-row">
                                <label class="form-label">Gi·ªõi t√≠nh</label>
                                <div class="radio-group">
                                    <label><input type="radio" [(ngModel)]="SelectedCustomer.GioiTinh" name="gioitinh" value="Nam"> Nam</label>
                                    <label><input type="radio" [(ngModel)]="SelectedCustomer.GioiTinh" name="gioitinh" value="N·ªØ"> N·ªØ</label>
                                </div>
                            </div>

                            <label>ƒê·ªãa ch·ªâ</label>
                            <input type="text" [(ngModel)]="SelectedCustomer.DiaChi" name="DiaChi">
                        </div>

                        <!-- C·ªôt 2 -->
                        <div>
                            <div class="form-row">
                                <label class="form-label">Lo·∫°i kh√°ch</label>
                                <div class="radio-group">
                                    <label><input type="radio" [(ngModel)]="SelectedCustomer.LoaiKhach" name="loaikhach" value="C√° nh√¢n"> C√° nh√¢n</label>
                                    <label><input type="radio" [(ngModel)]="SelectedCustomer.LoaiKhach" name="loaiKhach" value="C√¥ng ty"> C√¥ng ty</label>
                                </div>
                            </div>
                            <label>M√£ s·ªë thu·∫ø</label>
                            <input type="text" [(ngModel)]="SelectedCustomer.MaSoThue" name="MaSoThue">

                            <label>CMND/CCCD</label>
                            <input type="text" [(ngModel)]="SelectedCustomer.CmndCccd" name="CmndCccd">

                            <label>Email</label>
                            <input type="text" [(ngModel)]="SelectedCustomer.Email" name="Email">

                            <label>Facebook</label>
                            <input type="text" [(ngModel)]="SelectedCustomer.Facebook" name="Facebook">

                            <label>Ghi ch√∫</label>
                            <textarea [(ngModel)]="SelectedCustomer.GhiChu" name="GhiChu"></textarea>
                            <input type="hidden" [(ngModel)]="SelectedCustomer.NgayTao" name="NgayTao" >
                            <input type="hidden" [(ngModel)]="SelectedCustomer.NguoiTao" name="NguoiTao">
                            <input type="hidden" [(ngModel)]="SelectedCustomer.TrangThai" name="TrangThai">
                        </div>
                    </div>
                    <!-- Footer -->
                    <div class="modal-footer">
                        <button type="submit"  class="btn-save"><i class="fa-solid fa-floppy-disk"></i> L∆∞u</button>
                        <button type="button" (click)="closeModal()" class="btn-cancel"><i class="fa-solid fa-ban"></i> B·ªè qua</button>
                    </div>
                </form>
            </div>
        </div>
      <div *ngIf="showSuccess" class="custom-toast success-toast">
        <i class="fa fa-check-circle"></i>
        <span>Th√¥ng tin kh√°ch h√†ng ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng</span>
        </div>
         <div *ngIf="showSuccessde" class="custom-toast success-toast">
        <i class="fa fa-check-circle"></i>
        <span>Th√¥ng tin kh√°ch h√†ng ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng</span>
        </div>
        <div *ngIf="showSuccesskh" class="custom-toast success-toast">
            <i class="fa fa-check-circle"></i>
            <span>Import kh√°ch h√†ng th√†nh c√¥ng</span>
        </div>
        <!-- form x√°c nh·∫≠n x√≥a nh√¨u kh√°ch h√†ng -->
       <div class="delete-modal-backdrop" *ngIf="showDeleteConfirmModal">
        <div class="delete-modal-box">
            <h3>X√°c nh·∫≠n x√≥a</h3>
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a <strong>{{ selectedIdsToDelete.length }}</strong> kh√°ch h√†ng?</p>
            <div class="delete-modal-footer">
            <button class="btn-danger" (click)="deleteSelectedConfirmed()">
                <i class="fas fa-trash-alt"></i> X√≥a
            </button>
            <button class="btn-secondary" (click)="showDeleteConfirmModal = false">
                <i class="fas fa-ban"></i> H·ªßy
            </button>
            </div>
        </div>
        </div>
       <!-- Import Modal -->
       <div class="import-overlay" *ngIf="showImportForm">
        <div class="import-modal">
            <div class="modal-header">
            <h3>Import kh√°ch h√†ng t·ª´ Excel</h3>
            <button class="close-btn" (click)="showImportForm = false">√ó</button>
            </div>

            <div class="modal-body">
            <p>üìã ƒê·ªãnh d·∫°ng file ƒë√∫ng nh∆∞ m·∫´u: <a href="/assets/images/khachhang-template.xlsx" download>T·∫£i file m·∫´u</a></p>
            <input type="file" (change)="onFileSelected($event)" accept=".xlsx, .xls" />
            <button class="btn btn-success" (click)="uploadFile()" [disabled]="!selectedImportFile">Import</button>
            </div>
        </div>
        </div>
         <!-- ph√¢n trang -->
        <div class="pagination" *ngIf="totalPages > 1">
            <button class="page-btn" [disabled]="currentPage === 1" (click)="prevPage()">
                <i class="fas fa-chevron-left"></i>
            </button>

            <button 
                class="page-btn" 
                *ngFor="let page of [].constructor(totalPages); let i = index" 
                [class.active]="currentPage === i + 1"
                (click)="goToPage(i + 1)">
                {{ i + 1 }}
            </button>

            <button class="page-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

    </main>
</div>

<app-footer></app-footer>
